---
title: "0923 Data"
author: "Candy Gao"
date: "2022-11-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(devtools)
devtools::install_local("/Users/candygao/Desktop/TSAR_0.1.0.tar.gz")
library(TSAR)
library(dplyr)
library(ggplot2)
```

## load data

```{r}
raw_data <- read.delim(header = TRUE, skip = 118428, nrow = 118176, "/Users/candygao/Desktop/qpcrresult/experiment file/0923Thermal_Shift.txt")
#raw_data <- read.delim(header = TRUE, skip = 1, file = "/Users/candygao/Desktop/raw.txt")
```

## select individual cell for analysis

```{r}
test <- raw_data %>%
  filter(Well.Position == "A1") # select data for one well by well ID

#section data by temperature to remove messy area
#test <- subset(test, test$Temperature>40 & test$Temperature <50) 

test <- normalize(test, Fluo = 5, selected = c("Well.Position", "Temperature", "Fluorescence", "Normalized")) 
head(test)
gammodel <- model_gam(test, x = test$Temperature, y = test$Normalized)
test <- model_fit(test, model = gammodel) #, smoothed="Fluorescence")


Tm_est(test)


#graphing
result <- ggplot(data = test, aes(x = Temperature, y = Normalized)) +
  geom_point(shape = 1)+ #normalized data
  geom_point(aes(y=fitted), color = "blue", alpha = 1/10)+ #fitted value
  geom_vline(xintercept = Tm_est(test), color = "red") #tm temperature value

result
```

## 96 well application

```{r, echo = FALSE}
#run analysis
x <- gam_analysis(raw_data, smoothed = T, selections = c("Well.Position", "Temperature", "Fluorescence", "Normalized"))

#write output data file
write_tsar(read_tsar(x, code = 2), name = "0923_tm_val", file = "csv")

#look at only tm result by well
output <- read_tsar(x, code = 0)
head(output)
tail(output)

#join protein and ligand information 
norm_data <- join_well_info("/Users/candygao/Desktop/qpcrresult/experiment file/0923Well Information Template.xlsx", output, type = "by_template")
head(norm_data)
```
